=========================================
      t.me/autoacts - Shop Bot Setup
=========================================
Autor: t.me/autoacts
Version: 0.1.3

--- 1. ENVIRONMENT VARIABLES (Render.com) ---
Diese Variablen müssen im Render Dashboard unter "Environment" eingetragen werden:

TELEGRAM_BOT_TOKEN = (Dein Bot Token vom @BotFather)
SUPABASE_URL       = (Deine Supabase Projekt URL)
SUPABASE_KEY       = (Dein Service Role Key - WICHTIG: Nicht den Anon Key!)
MASTER_ADMIN_ID    = (Deine numerische Telegram ID - Volle Kontrolle)
PORT               = 10000 (Standard für Render Web Services)

--- 2. SUPABASE SQL SETUP ---
Kopiere die folgenden Befehle nacheinander in den SQL Editor deiner Supabase Instanz:

-- Tabelle: Users (Kunden und Admins)
CREATE TABLE users (
    telegram_id BIGINT PRIMARY KEY,
    username TEXT,
    role TEXT DEFAULT 'customer', -- 'admin', 'customer'
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Tabelle: Kategorien
CREATE TABLE categories (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    is_active BOOLEAN DEFAULT TRUE
);

-- Tabelle: Produkte
-- Erlaubt NULL für category_id (Kategorielose Produkte / Sonstiges)
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    category_id INTEGER REFERENCES categories(id) ON DELETE SET NULL, 
    name TEXT NOT NULL,
    description TEXT,
    price DECIMAL(10,2) NOT NULL,
    is_unit_price BOOLEAN DEFAULT FALSE,
    is_out_of_stock BOOLEAN DEFAULT FALSE,
    image_url TEXT, -- Dezentrale Links (z.B. telegra.ph)
    is_active BOOLEAN DEFAULT TRUE
);

-- Tabelle: Zahlungsarten
CREATE TABLE payment_methods (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT,
    wallet_address TEXT,
    is_active BOOLEAN DEFAULT TRUE
);

-- Tabelle: Warenkorb
CREATE TABLE carts (
    id SERIAL PRIMARY KEY,
    user_id BIGINT REFERENCES users(telegram_id) ON DELETE CASCADE,
    product_id INTEGER REFERENCES products(id) ON DELETE CASCADE,
    quantity INTEGER DEFAULT 1
);

-- Tabelle: Ausstehende Freigaben (Approval-System für Master Admin)
CREATE TABLE pending_approvals (
    id SERIAL PRIMARY KEY,
    action_type TEXT NOT NULL, -- 'DELETE', 'PRICE_CHANGE'
    requested_by BIGINT REFERENCES users(telegram_id),
    target_id INTEGER, -- ID des betroffenen Produkts
    new_value TEXT,    -- Z.B. der neue Preis
    status TEXT DEFAULT 'pending', -- 'pending', 'approved', 'rejected'
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- INDEXE für schnellere Abfragen (Empfohlen für v0.1.3)
CREATE INDEX idx_products_category ON products(category_id);
CREATE INDEX idx_products_active ON products(is_active);
CREATE INDEX idx_approvals_status ON pending_approvals(status);

=========================================
